model Team {
  id                String           @id @default(cuid())
  name              String
  slug              String           @unique
  logoUrl           String?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  members           TeamMember[]     // Relation to team memberships
  campaigns         Campaign[]       // Teams can now own campaigns
  messageTemplates  MessageTemplate[] // Teams can now own message templates
  contacts      Contact[]    // Teams can now own phone numbers
}

model TeamMember {
  id        String   @id @default(cuid())
  role      String   @default("MEMBER") // e.g., "ADMIN", "MEMBER"
  userId    String
  teamId    String
  joinedAt  DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  team      Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@unique([userId, teamId])
}


model Campaign {
  id          String          @id @default(cuid())
  name        String
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  status      String          @default("DRAFT")
  scheduledAt DateTime?
  teamId      String
  templateId  String
  userId      String
  team        Team            @relation(fields: [teamId], references: [id], onDelete: Cascade)
  template    MessageTemplate @relation(fields: [templateId], references: [id])
  user        User            @relation(fields: [userId], references: [id])
  messages    Message[]
}

model MessageTemplate {
  id        String     @id @default(cuid())
  title     String
  content   String
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  teamId    String
  userId    String
  campaigns Campaign[]
  user      User       @relation(fields: [userId], references: [id])
  team      Team      @relation(fields: [teamId], references: [id], onDelete: Cascade)
}

model Message {
  id           String      @id @default(cuid())
  message      String
  status       String      @default("PENDING")
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  sentAt       DateTime?
  errorMessage String?
  campaignId   String
  phoneId      String
  campaign     Campaign    @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  recipient    Contact     @relation(fields: [phoneId], references: [id], onDelete: Cascade)
}

model Contact {
  id        String    @id @default(cuid())
  phone    String
  name      String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  userId    String
  teamId    String
  messages  Message[]
  user      User      @relation(fields: [userId], references: [id])
  team      Team      @relation(fields: [teamId], references: [id])

  @@unique([teamId, phone])
}
